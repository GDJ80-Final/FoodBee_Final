<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.gd.foodbee.mapper.AttendanceMapper">
	<!-- 근태보고 출력 -->
	<select id="selectTime" resultType="com.gd.foodbee.dto.AttendanceDTO" parameterType="int">
		SELECT 
			emp_no, 
			date, 
			DATE_FORMAT(start_time, '%H:%i') startTime, 
			DATE_FORMAT(end_time, '%H:%i') endTime,
			DATE_FORMAT(update_start_time, '%H:%i') updateStartTime,
			DATE_FORMAT(update_end_time, '%H:%i') updateEndTime
		FROM 
			attendance 
		WHERE 
			emp_no = #{empNo} 
			AND 
			date = DATE_SUB(CURDATE(), INTERVAL 1 DAY)
		ORDER BY 
			date DESC;
	</select>
	
	<!-- 근태보고(승인자) 출력 -->
	<select id="selectTeamLeader" resultType="map" parameterType="String">
		SELECT 
			rank_name rankName, 
			emp_name empName
		FROM 
			emp
		WHERE 
			dpt_no = #{dptNo} 
			AND 
			rank_name = '팀장'
	</select>
	
	<!-- 근태보고 수정 -->
	<update id="updateTime" parameterType="map">
		UPDATE 
			attendance 
		SET 
			update_start_time = CONCAT(DATE(update_start_time), ' ', #{updateStartTime}, ':00'), 
			update_end_time = CONCAT(DATE(update_end_time), ' ', #{updateEndTime}, ':00'),
			update_reason = #{updateReason}
		WHERE 
			emp_no = #{empNo} 
			AND 
			date = DATE_SUB(CURDATE(), INTERVAL 1 DAY)
	</update>
</mapper>